global
    log stdout local0
    log stdout local1 notice

defaults
    log global
    mode http
    option httplog
    option dontlognull
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

# 统计页面
listen stats
    bind *:8404
    mode http
    stats enable
    stats uri /stats
    stats refresh 10s
    stats admin if TRUE

# 前端
frontend nginx_front
    bind *:80
    default_backend nginx_back

# 后端 - 负载均衡
backend nginx_back
    mode http
    balance roundrobin
    option httpchk GET /
    http-check expect status 200
    server nginx1 nginx1:80 check inter 2000 rise 2 fall 3
    server nginx2 nginx2:80 check inter 2000 rise 2 fall 3

# HTTPS 前端
frontend nginx_front_https
    bind *:443
    default_backend nginx_back_https

# HTTPS 后端
backend nginx_back_https
    mode http
    balance roundrobin
    option httpchk GET /
    http-check expect status 200
    server nginx1 nginx1:80 check inter 2000 rise 2 fall 3
    server nginx2 nginx2:80 check inter 2000 rise 2 fall 3
